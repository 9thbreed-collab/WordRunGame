---
phase: 02-core-puzzle-loop
plan: 04
type: execute
wave: 3
depends_on: ["02-03"]
files_modified:
  - scripts/screens/menu_screen.gd
  - scenes/screens/menu_screen.tscn
  - scripts/screens/results_screen.gd
  - scenes/screens/results_screen.tscn
  - scripts/autoloads/game_manager.gd
  - project.godot
autonomous: true

must_haves:
  truths:
    - "Complete end-to-end flow: Menu -> Play -> Gameplay -> Results -> Menu"
    - "GameManager routes between MenuScreen, GameplayScreen, ResultsScreen"
    - "Application starts on MenuScreen (not test_screen)"
    - "ResultsScreen shows win/lose state and navigation options"
  artifacts:
    - path: "scenes/screens/menu_screen.tscn"
      provides: "Main entry point with Play button"
    - path: "scenes/screens/results_screen.tscn"
      provides: "Post-level results with Play Again and Menu buttons"
  key_links:
    - from: "scripts/screens/menu_screen.gd"
      to: "scripts/autoloads/game_manager.gd"
      via: "Calls GameManager.change_screen() to start gameplay"
    - from: "scripts/screens/results_screen.gd"
      to: "scripts/autoloads/game_manager.gd"
      via: "Calls GameManager.change_screen() for restart or menu"
    - from: "scripts/screens/gameplay_screen.gd"
      to: "scripts/autoloads/event_bus.gd"
      via: "level_completed and level_failed trigger screen transitions"
---

<objective>
Integrate the playable GameplayScreen into the full application flow. Create menu and results screens, wire screen transitions through GameManager, and set MenuScreen as the app entry point. Delivers a complete user journey: Menu -> Play -> Win/Lose -> Results -> Menu.

Output: MenuScreen, ResultsScreen, updated GameManager routing, end-to-end gameplay loop.
</objective>

<execution_context>
@/Users/nathanielgiddens/.claude/get-shit-done/workflows/execute-plan.md
@/Users/nathanielgiddens/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/02-core-puzzle-loop/02-RESEARCH.md
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/02-core-puzzle-loop/02-03-SUMMARY.md
@scripts/autoloads/game_manager.gd
@project.godot
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create MenuScreen and ResultsScreen</name>
  <files>
    scenes/screens/menu_screen.tscn
    scripts/screens/menu_screen.gd
    scenes/screens/results_screen.tscn
    scripts/screens/results_screen.gd
  </files>
  <action>
    Create MenuScreen:
    1. Create `scenes/screens/menu_screen.tscn` with Control root (full rect)
    2. Add VBoxContainer centered on screen
    3. Add Label with text "WordRun!" -- large title font
    4. Add Button "Play" with custom_minimum_size = Vector2(300, 72) for mobile touch
    5. Add BannerAdRegion instance at bottom
    6. Create `scripts/screens/menu_screen.gd`:
       - Connect Play button pressed to _on_play_pressed
       - _on_play_pressed(): GameManager.transition_to(GameManager.AppState.MENU); GameManager.change_screen("res://scenes/screens/gameplay_screen.tscn")

    Create ResultsScreen:
    1. Create `scenes/screens/results_screen.tscn` with Control root (full rect)
    2. Add VBoxContainer centered on screen
    3. Add ResultLabel (Label, unique name %ResultLabel) -- "Level Complete!" or "Time's Up!"
    4. Add WordsSolvedLabel (Label, unique name %WordsSolvedLabel) -- placeholder for words solved count
    5. Add TimeTakenLabel (Label, unique name %TimeTakenLabel) -- placeholder for time display
    6. Add Button "Play Again" with minimum 72px height
    7. Add Button "Main Menu" with minimum 72px height
    8. Add BannerAdRegion instance at bottom
    9. Create `scripts/screens/results_screen.gd`:
       - Connect "Play Again" pressed to: GameManager.change_screen("res://scenes/screens/gameplay_screen.tscn")
       - Connect "Main Menu" pressed to: GameManager.change_screen("res://scenes/screens/menu_screen.tscn")
       - In _ready(): call GameManager.transition_to(GameManager.AppState.RESULTS)
  </action>
  <verify>
    1. menu_screen.tscn has title label, play button, banner region
    2. results_screen.tscn has result label, stat placeholders, two navigation buttons
    3. Both scripts route through GameManager.change_screen()
  </verify>
  <done>
    - MenuScreen and ResultsScreen scenes and scripts created
    - Both use GameManager for navigation
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire GameManager routing and update main_scene</name>
  <files>
    scripts/autoloads/game_manager.gd
    scripts/screens/gameplay_screen.gd
    project.godot
  </files>
  <action>
    Update GameManager:
    1. Open `scripts/autoloads/game_manager.gd`
    2. In _ready(), connect EventBus signals for screen routing:
       - EventBus.level_completed.connect(_on_level_completed)
       - EventBus.level_failed.connect(_on_level_failed)
    3. Add handlers:
       - _on_level_completed(): transition_to(AppState.RESULTS); change_screen("res://scenes/screens/results_screen.tscn")
       - _on_level_failed(): transition_to(AppState.RESULTS); change_screen("res://scenes/screens/results_screen.tscn")

    Update GameplayScreen:
    1. In gameplay_screen.gd, remove any direct screen transitions from _level_complete() and _level_failed()
    2. These methods should ONLY emit EventBus signals -- GameManager handles the routing

    Update main_scene:
    1. In project.godot, change run/main_scene from test_screen.tscn to menu_screen.tscn:
       `run/main_scene="res://scenes/screens/menu_screen.tscn"`
  </action>
  <verify>
    1. GameManager connects to level_completed and level_failed signals
    2. GameManager routes to results_screen on both signals
    3. gameplay_screen.gd only emits signals, doesn't change scenes directly
    4. project.godot main_scene = menu_screen.tscn
    5. Full flow works: Menu -> Play -> Gameplay -> (win or timeout) -> Results -> Menu or Play Again
  </verify>
  <done>
    - GameManager routes between all screens via EventBus
    - Gameplay screen decoupled from navigation
    - MenuScreen is app entry point
    - End-to-end loop functional
  </done>
</task>

</tasks>

<verification>
Requirements validated by this plan:
- All PUZL requirements are now integrated into a complete, playable flow
- Phase 2 success criteria met: player can launch a level from menu, solve words, see results, replay
</verification>

<success_criteria>
1. MenuScreen created with Play button that launches GameplayScreen
2. ResultsScreen created with Play Again and Main Menu buttons
3. GameManager handles level_completed/level_failed -> ResultsScreen transition
4. project.godot main_scene updated to menu_screen.tscn
5. Full end-to-end flow: Menu -> Gameplay -> Results -> Menu works
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-puzzle-loop/02-04-SUMMARY.md`
</output>

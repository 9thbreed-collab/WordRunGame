# Plan 03-02: Audio Manager and Haptics
Phase: 3 -- Game Feel, Surge, Score, and Audio
Depends on: 03-01

## Context References
- scripts/autoloads/event_bus.gd (will have surge signals after 03-01)
- project.godot (autoload registration)
- .planning/phases/03-game-feel-surge-score-audio/03-RESEARCH.md

## Tasks

### Task 1: Create AudioManager Autoload
**Files:** Create scripts/autoloads/audio_manager.gd
**Steps:**
1. Define as Node (will be autoload)
2. Create SFX player pool in _ready(): 10 AudioStreamPlayer children, bus = "SFX"
3. Create 2 AudioStreamPlayer children for BGM (bgm_a, bgm_b), bus = "BGM"
4. func play_sfx(stream: AudioStream) -- find first idle player, assign stream, play
5. func play_bgm(stream: AudioStream) -- crossfade: fade out current, fade in new on the other player
6. func stop_bgm() -- fade out current BGM player
7. var _current_bgm_player: AudioStreamPlayer tracking which is active

### Task 2: Configure Audio Buses and Register Autoload
**Files:** Create default_audio_bus_layout.tres, Modify project.godot
**Steps:**
1. Create audio bus layout with buses: Master, BGM (parent: Master), SFX (parent: Master)
2. Set default volumes (BGM slightly lower than SFX)
3. Add AudioManager to project.godot [autoload] section after PlatformServices

### Task 3: Generate Placeholder SFX
**Files:** Create assets/audio/sfx/ directory with placeholder .wav or .ogg files
**Steps:**
1. Create minimal placeholder audio files (can be generated programmatically or use tiny silent/beep files)
2. Files needed: letter_tap.wav, word_correct.wav, word_incorrect.wav, surge_fill.wav, surge_threshold.wav, surge_bust.wav, level_complete.wav
3. If programmatic generation not feasible, create AudioStream resources that reference empty/tiny files

### Task 4: Wire SFX to EventBus Signals
**Files:** Modify scripts/autoloads/audio_manager.gd
**Steps:**
1. Preload all SFX streams as class-level vars
2. In _ready(), connect to EventBus signals:
   - letter_input -> play letter_tap
   - word_completed -> play word_correct
   - surge_threshold_crossed -> play surge_threshold
   - surge_bust -> play surge_bust
   - level_completed -> play level_complete
3. For word_incorrect: WordRow._flash_incorrect can emit a signal or AudioManager listens to a new EventBus signal
4. Add signal word_incorrect() to EventBus, emit from WordRow._flash_incorrect

### Task 5: Add Background Music
**Files:** Create assets/audio/bgm/ directory, Modify scripts/screens/gameplay_screen.gd
**Steps:**
1. Add a placeholder BGM file (looping)
2. In GameplayScreen._ready: call AudioManager.play_bgm(gameplay_bgm)
3. In _level_complete and _level_failed: call AudioManager.stop_bgm()

### Task 6: Add Haptic Feedback
**Files:** Modify scripts/autoloads/audio_manager.gd (or create scripts/autoloads/haptic_manager.gd)
**Steps:**
1. Add haptic calls alongside SFX calls in AudioManager (keeps feedback co-located):
   - letter_input: Input.vibrate_handheld(30) -- light tap
   - word_completed: Input.vibrate_handheld(100) -- medium buzz
   - surge_bust: Input.vibrate_handheld(400) -- heavy vibration
   - level_completed: Input.vibrate_handheld(200) -- celebration buzz
2. Guard with OS.get_name() check if needed (vibrate_handheld is no-op on desktop)

## Verification
- BGM plays when gameplay starts, stops on level end
- Typing a letter produces a tap sound
- Completing a word produces a success sound
- Wrong answer produces an error sound
- Surge threshold crossing produces a power-up sound
- Bust produces a dramatic failure sound
- Haptics fire on mobile (no-op on desktop is fine)

## Decisions
- 03-02-D1: AudioManager is an autoload (global audio control, persists across scenes)
- 03-02-D2: SFX pool of 10 players allows concurrent sounds without instantiation during gameplay
- 03-02-D3: Haptic calls co-located with SFX in AudioManager (feedback is one concept)
- 03-02-D4: Placeholder audio files used initially -- real assets sourced in Phase 8 (Polish)
